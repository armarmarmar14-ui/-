<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<title>Компьютерлік дүкен</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f9;
    margin: 0; padding: 0;
}
header {
    background: #4CAF50;
    color: white;
    text-align: center;
    padding: 20px 0;
}
.container {
    width: 90%;
    max-width: 900px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}
th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: center;
}
th {
    background: #f2f2f2;
}
button {
    padding: 5px 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
button.sell { background: #4CAF50; color: white; }
button.cancel { background: #FF9800; color: white; }
button.delete { background: #f44336; color: white; }
button.add { background: #2196F3; color: white; margin-top: 10px; }
.section { margin-top: 20px; }
p { font-weight: bold; margin: 5px 0; }
.stat-block {
    background: #e8f0fe;
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
}
input { margin: 5px 0; padding: 5px; width: 100%; }

/* Диаграмма стиль */
.charts {
    display:flex;
    gap:5px;
    margin-top:5px;
    flex-wrap: wrap;
}
.chart-box { width:75px; height:75px; }
.chart-box canvas { width:75px !important; height:75px !important; }

/* Іздеу кезінде ерекшелеу */
.highlight {
    background-color: #ffff99 !important;
    transition: background-color 1s ease;
}
</style>
</head>
<body>

<header>
<h1>Компьютерлік дүкенді басқару жүйесі</h1>
</header>

<div class="container">
<h2>Тауар қосу</h2>
ID: <input type="number" id="productId"><br>
Атауы: <input type="text" id="productName"><br>
Саны: <input type="number" id="productQty"><br>
Бағасы: <input type="number" id="productPrice"><br>
<button class="add" onclick="addProduct()">Қосу</button>

<h2>ID арқылы поиск</h2>
<input type="number" id="searchId" placeholder="ID енгізіңіз">
<button onclick="searchById()">Іздеу</button>
<button onclick="clearSearch()">Тазалау</button>

<h2>ID арқылы сату / отмена</h2>
ID: <input type="number" id="modifyId"><br>
Саны: <input type="number" id="modifyQty"><br>
<button class="sell" onclick="sellById()">Сату</button>
<button class="cancel" onclick="cancelById()">Отмена</button>

<div class="section">
<h2>Тауарлар тізімі</h2>
<table id="productTable"></table>
</div>

<div class="section">
<h2>Әр тауар статистикасы</h2>
<div id="productStats"></div>
</div>
</div>

<script>
let products = [];
let lastHighlightId = null;

// Сақтау және жүктеу
function saveProducts() {
    localStorage.setItem("products", JSON.stringify(products));
}
function loadProducts() {
    let data = localStorage.getItem("products");
    if(data) products = JSON.parse(data);
}

// Диаграмма сызу
function drawPie(id, labels, data, colors){
    new Chart(document.getElementById(id), {
        type:'pie',
        data:{ labels, datasets:[{ data, backgroundColor:colors }] },
        options:{ responsive:false, maintainAspectRatio:true, plugins:{ legend:{ display:false } } }
    });
}

// Кесте мен статистиканы көрсету
function renderStats(filterId=null) {
    let statsDiv = document.getElementById("productStats");
    statsDiv.innerHTML = "";
    let list = filterId ? products.filter(p=>p.id==filterId) : products;
    list.forEach(p => {
        let remainingSum = p.price * (p.qty - (p.sold || 0));
        let soldSum = (p.sold || 0) * p.price;

        let div = document.createElement("div");
        div.className = "stat-block";
        div.id = "stat-" + p.id;
        div.innerHTML = `
            <p><strong>ID:</strong> ${p.id} | <strong>Атауы:</strong> ${p.name}</p>
            <p>Қалған саны: ${p.qty - (p.sold || 0)} | Қалған сомасы: ${remainingSum} тг</p>
            <p>Сатылған саны: ${p.sold || 0} | Сатылған сомасы: ${soldSum} тг</p>
            <div class="charts">
                <div class="chart-box"><canvas id="count${p.id}"></canvas></div>
                <div class="chart-box"><canvas id="sum${p.id}"></canvas></div>
            </div>
        `;
        statsDiv.appendChild(div);

        drawPie(`count${p.id}`, ['Сатылған','Қалған'], [p.sold || 0, p.qty - (p.sold || 0)], ['#f44336','#4CAF50']);
        drawPie(`sum${p.id}`, ['Сатылған сумма','Қалған сумма'], [soldSum, remainingSum], ['#FF9800','#2196F3']);
    });
}

function renderTable() {
    let table = document.getElementById("productTable");
    table.innerHTML = `
    <tr>
        <th>ID</th><th>Атауы</th><th>Саны</th><th>Бағасы</th>
        <th>Сатылған</th><th>Сату</th><th>Отмена</th><th>Өшіру</th>
    </tr>`;
    products.forEach((p,index)=>{
        table.innerHTML += `
        <tr id="row-${p.id}">
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>${p.qty}</td>
            <td>${p.price}</td>
            <td>${p.sold || 0}</td>
            <td><button class="sell" onclick="sellOne(${index})">+1 Сату</button></td>
            <td><button class="cancel" onclick="cancelOne(${index})">-1 Отмена</button></td>
            <td><button class="delete" onclick="deleteProduct(${index})">Өшіру</button></td>
        </tr>`;
    });
    renderStats();
}

// Іздеу
function searchById(){
    clearSearch();
    let id = document.getElementById("searchId").value;
    if(!id) return;
    let row = document.getElementById("row-" + id);
    let stat = document.getElementById("stat-" + id);
    if(row && stat){
        row.classList.add("highlight");
        stat.classList.add("highlight");
        row.scrollIntoView({behavior:"smooth", block:"center"});
        lastHighlightId = id;
    } else {
        alert("Тауар табылмады!");
    }
}

// Іздеуді тазалау
function clearSearch(){
    if(lastHighlightId){
        let row = document.getElementById("row-" + lastHighlightId);
        let stat = document.getElementById("stat-" + lastHighlightId);
        if(row) row.classList.remove("highlight");
        if(stat) stat.classList.remove("highlight");
        lastHighlightId = null;
    }
}

// Тауар қосу
function addProduct() {
    let id = parseInt(document.getElementById("productId").value);
    let name = document.getElementById("productName").value;
    let qty = parseInt(document.getElementById("productQty").value);
    let price = parseFloat(document.getElementById("productPrice").value);
    if(id && name && qty && price){
        products.push({id,name,qty,price,sold:0});
        saveProducts();
        renderTable();
        alert("Тауар қосылды!");
    } else { alert("Барлық өрістерді толтырыңыз!"); }
}

// Бір бірліктен сату
function sellOne(index){
    if(products[index].qty - (products[index].sold || 0) > 0){
        products[index].sold += 1;
        saveProducts();
        renderTable();
    } else { alert("Саны жеткіліксіз!"); }
}

// Бір бірліктен отмена
function cancelOne(index){
    if(products[index].sold > 0){
        products[index].sold -= 1;
        saveProducts();
        renderTable();
    }
}

// ID арқылы сату
function sellById() {
    let id = parseInt(document.getElementById("modifyId").value);
    let qty = parseInt(document.getElementById("modifyQty").value);
    let product = products.find(p => p.id === id);
    if(product && qty > 0){
        let available = product.qty - (product.sold || 0);
        if(available >= qty){ product.sold += qty; saveProducts(); renderTable(); alert(qty + " тауар сатылды!"); }
        else alert("Қолда бар саны жеткіліксіз! Қолда бар: " + available);
    } else alert("Қате ID немесе сан!");
}

// ID арқылы отмена
function cancelById() {
    let id = parseInt(document.getElementById("modifyId").value);
    let qty = parseInt(document.getElementById("modifyQty").value);
    let product = products.find(p => p.id === id);
    if(product && qty > 0){
        if((product.sold || 0) >= qty){ product.sold -= qty; saveProducts(); renderTable(); alert(qty + " тауар сатылмаған ретінде қайтарылды!"); }
        else alert("Сатылған саны жеткіліксіз! Қолда бар: " + (product.sold || 0));
    } else alert("Қате ID немесе сан!");
}

// Кестедегі өшіру
function deleteProduct(index){
    products.splice(index,1);
    saveProducts();
    renderTable();
}

// Бастапқы жүктеу
loadProducts();
renderTable();
</script>

</body>
</html>
